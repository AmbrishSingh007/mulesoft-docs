// sme: PLG, Shoki?, author: sduke?
= Migrating from DataWeave 1.0 to 2.x

// Explain generally how and why things changed between Mule 3 and Mule 4.
Intro here.

What's covered in this section:

* <<topic_1>>
* <<topic_2>>

[[topic_1]]
== DataWeave Directive Syntax Changed

* Updated version header to `%dw 2.0`.
* Removed `%` from all other directives.

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

[[topic_2]]
== Removed Automatic Coercions from Object to Array

Removed automatic coercion from Object to Array (implies, for example, that the `map` function no longer works over an Object).

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

[[flat_file]]
== Flat File Content Type

For the flat file, the content type is `application/flatfile` instead of `text\plain`.

.Mule 3 example
----
text\plain
----

.Mule 4 example
----
application/flatfile
----

== Type Name Format Change

Changed all type names format, which are now written without a colon and with an upper case letter (for example, `Object` instead of `:object`, as before).

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

== DataWeave Operator Syntax Change

All operators are now functions (for example, `upper()`, `typeOf()`). Therefore, they must include their arguments between parenthesis.

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

== Changes to Functions

* Custom functions are declared in the DataWeave header via the keyword `fun`, rather than `function`. For example, `fun funName(args) = body`
* `when`, `unless` and `otherwise` are no longer used for conditional logic. They have been replaced by `if` and `else`. This requires that you change the order of the expression. Example: `if payload is(String) uppercase(payload)`.
* Binary functions (that take two arguments) support an alternative infix notation (arg1 function arg2). For example, `payload.*items contains "3"` instead of `contains(payload.*items, "3")`.
* The functions `filter` and `groupBy` are overloaded to operate on objects.
* The functions `map`, `mapObject` and `filter` support a null input (in which case they return null).
* New supported syntax for `match` when using arrays `[head ~ tail]`
* Multiple functions are no longer packaged as part of the core functions module. The package they belong to must be manually imported in the header before they can be called.
* Index parameter: Added `index` as a third parameter to `mapObject`, `pluck`, `filter`, and `groupBy`.

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

== Changes to Selectors

* The `..` operator is no longer used for selecting ranges (but still works as a descendants selector). Its functionality is replaced by `to`. Example: `[2 to 15]`.
* New key-value pair selector (`.&`) returns all matching keys and values. It returns them as a single object containing these.
* New namespace selector (`.#`) returns the namespace used.
 ** Namespace prefixes can no longer contain the character `-`.
* Repeated fields: Added the asterisk (`\*`) for repeated fields in an object, for example: `{ a*: String}`. This is primarily needed for XML, where the names of child elements can be repeated, unlike keys in Java and JSON objects.

.Mule 3 example
----
Mule 3 example goes here.
----

.Mule 4 example
----
Mule 4 example goes here.
----

== Object-specific Syntax

* Closed objects: For declared types, added the pipe (`|`) syntax to specify a closed (or exact) object. For example, if `{|a: String|}` is specified as a return type of a function, the function cannot return `{a: String, b: Number}`.
* Ordered objects: Added the hyphen character (`-`) for ordered objects, for example: `{- a: String, b: Number -}`. The fields must be in the specified order.

== OTHER TODOS...

TODO: MENTIONS OF DATAWEAVE NOTE HERE. In most cases, the DW info relates to a change to a processor, so prob best fits into migration doc for that processor.
* https://beta-anypt.docs-stgx.mulesoft.com/mule-user-guide/v/4.0/mule-4-changes

NOTE: Content above CAME from here:
* https://beta-anypt.docs-stgx.mulesoft.com/mule-user-guide/v/4.0/dataweave2-syntax-changes)

TODO: Here are changes between 2.0 and 2.1 (TODO: determin which have migration impacts)
* Do
* Type System
* Modules (imports)
* Custom String interpolation
* UrlEncoded, Multipart, text plain, binary (reader writers)
* Object field selector
* Functions for infix notation
* Function overloading with different types


////
To get started, see which of these have migration impacts: https://beta-anypt.docs-stgx.mulesoft.com/release-notes/mule-4.0-beta-release-notes#dataweave-2-0-new-features and see https://beta-anypt.docs-stgx.mulesoft.com/release-notes/mule-4.0-rc-release-notes.

////


== See Also

link:migration-examples[Migration Examples]

link:migration-patterns[Migration Patterns]

link:migration-components[Migrating Components]
