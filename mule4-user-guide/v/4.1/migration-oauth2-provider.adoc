= Migrating the OAuth2 Provider

The new OAuth2 Provider Module from Mule4 comes to replace the previous provider from the Mule Security Module.
However, there are some configuration changes that need to be taken into account when migrating the applications.

== Global Configuration Migration

The following are the changes made in the Providers global configuration and the differences that they have between versions.

=== Changed Attributes

Attribute status:

* Kept: Has same name, type and location.
* Moved: The attribute has the same type and name but the location where it should be configured changed.
* Changed: The type or name changed but the location is the same.
* Removed: The attribute no longer exists.


[options="header"]
|======================
| Mule 3 Attribute | Status | Mule 4 Config
| Name | Kept | Name
| Provider Name | Kept | Provider Name
| Host | Removed | The host is taken from the Http Configuration in *Listener Config*
| Port | Removed | The port is taken from the Http Configuration in *Listener Config*
| Client Store Ref | Changed | The attribute is now an Object Store. Needs to be a ref or an Private Object Store definition
| Authorization Code Store Ref | Moved, Changed | The authorization code store should now be configured as an attribute of *Authorization Config* and it should be an Object Store
| Token Store Ref | Moved, Changed | The token store should now be configured as an attribute of *Token Config* and it should be an Object Store
| Login Page | Moved | The login page is configured as an attribute of *Authorization Config*
| Scopes | Kept | Should now be comma separated
| Default Scopes | Kept | Should now be comma separated
| Supported Grant Types | Kept | Should now be comma separated
| Authorization Endpoint Path | Changed, Moved | Configurable in the attribute _path_ of *Authorization Config*
| Access Token Endpoint Path | Changed, Moved | Configurable in the attribute _path_ of *Token Config*
| Authorization Ttl Seconds | Removed | The authorization code Ttl will be taken from the entry Ttl configured in the *Authorization Code Store* object store.
| Token Ttl Seconds | Moved, Changed | The token Ttl will be taken from the *Token Store* object store. Due to a limitation in the code, it is asked that the field is also configured in the attributes _tokenTtl_ and _tokenTtlTimeUnit_ of *TokenConfig*. The *Token Store* _entryTtl_ and *Token Config* _tokenTtl_ (and _tokenTtlTimeUnit_) must be the same.
| Refresh Token Ttl Seconds | Removed | The refresh token Ttl will be taken from the entry Ttl of the Object Store configuren in the *Refresh Token Strategy* in case there is one.
| Connector | Removed | Transports were removed from Mule 4 so this field has no meaning anymore.
| HttpListenerConfig | Changed | Now it's called *Listener Config* and it's mandatory
| Resource Owner Security Provider Ref | Changed | *Ref* has been removed from the attribute's name. The Spring Module should be used if a Spring Security Provider is configured.
| Client Security Provider Ref | Changed | *Ref* has been removed from the attribute's name. The Spring Module should be used if a Spring Security Provider is configured.
| Enable Refresh Token | Removed | Configurable with a different *Refresh Token Strategy*
| Issue New Refresh Token | Removed | Configurable with a different *Refresh Token Strategy*
| Rate Limiter | Changed | You can no longer add a custom implementation from a spring bean. Only Period Rate Limiter is implemented for now.
| Clients | Kept | Each client definition changed
| Pre Flow | Removed | Pre flow functionality will not be supported in this version
|======================

== Stores
Authentication Code, Token or Refresh token stores no longer exist and there is no attribute that let's you reference a custom implementation of any of those.
Any storage configuration is now done with an Object Store.

If a custom behaviour is needed, then a custom implementation of an Object Store should be used to configure any of those attributes

== Security Providers

In Mule4 we decouple our code completely from Spring, so for some of the attributes that were configured by referencing a Spring Bean, the configuration has changed.

Spring security providers can still be used but, in that case, the Spring Module is needed in order for the application to work.

== Refresh Token Attributes

In Mule 3, there were 2 attributes that allowed the refresh token behaviour configuration. As now we have different Refresh Token Strategies, the configuration should be done the following way.

|=================
| *Enable Refresh Token* Value | *Issue New Refresh Token* Value | *Refresh Token Strategy*
| False | - | No Refresh Token Strategy
| True | False | Single Refresh Token Strategy
| True | True | Multiple Refresh Token Strategy
|=================

== Clients













== Operations

The following are the operations available in the module for Mule 3 and the changes they have for Mule 4

=== Validate Client

The operation was removed in Mule 4.

=== Validate

Now the operation is called *Validate Token*.

Since the OAuth2 Provider operations are no longer linked to HTTP, an expression to resolve the token to validate is required.

=== Create Client

=== Delete Client

=== Revoke Token

== Example

Here is an example of the same application configured in Mule 3 And Mule 4


== See Also
* link:/connectors/v/latest/oauth2-provider-documentation-reference[OAuth2 Provider Documentation Reference]