= Anypoint Partner Manager Basic Tutorial

This tutorial illustrates the role Anypoint Partner Manager Framework (APMF) plays in B2B transaction processing. APMF consists of two components:

* Anypoint Partner Manager (AP)
* Anypoint Partner Manager Routing Engine

The tutorial provides instructions for configuring APMF so that you can simulate a transaction and see how APMF processes it.

In the tutorial, you will:

* <<Configure a Supplier>>
* <<Design a Target Channel>>
* <<Configure a Buyer>>
* <<Design a Source Channel>>
* <<Configure an S3 Bucket (optional)>>
* <<Copy APM Information>>
* <<Download Tutorial Materials>>
* <<Configure APM Routing Engine in Anypoint Studio>>
* <<Start the Applications>>
* <<Send a Message>>
* <<Monitor the Transaction>>

== Before You Begin

Verify that you have the following:

* Anypoint Platform user account with APM access
+
NOTE: If you are unable to access APM, see your Mulesoft account administrator for assistance.

* Anypoint Studio with Mule 3.8.4 and the following connectors:
** AS2 v2.1.0
** FTPS v2.0.0
** EDIFACT EDI
** RosettaNet
** X12 v1.2.2
** Object Store v2.1.0
** Amazon SQS v4.1.0 (optional)


== Configure a Supplier

This tutorial works with two partners: a Supplier and a Buyer.

The Supplier is *AAZFasteners*, a fictional retailer of nuts and bolts, also identified on the xref:img-partner-configuration[] as *YOUR COMPANY*.

NOTE: In your copy of APM, *YOUR COMPANY* is probably not named *AAZFasteners*. However, for illustration purposes, we refer to *YOUR COMPANY* as *AAZFasteners* throughout this tutorial. If you want to change the name of *Your Company* to *AAZFasteners*, see link:/anypoint-b2b/partner-configuration#create-and-configure-partners[Create and Configure Partners]. However, the tutorial will work without making the change.

The other partner in this tutorial is the _Buyer_, a fictional retailer of home supplies. In <<Create the Buyer Partner>>, we create this partner, identifying it as *AcmeHomeSupply*.
In the tutorial, AcmeHomeSupply uses APM to order products from AAZFasteners. In the following sections, you will:

* <<Add Supplier Identifiers>>

* <<Upload Certificates>>

=== Add Supplier Identifiers

_Identifiers_ are values, communicated in messages, that can be used to uniquely identify a specific partner. Some identifiers are defined by standards bodies, such as _DUNS numbers_, which are assigned by Dun and Bradstreet. Others are mutually defined between partners. AS2 uses identifiers to identify the sender and receiver of a transmission. X12 and EDIFACT use identifiers to identify the sender and receiver of an EDI document.

For these partners, we use two identifiers:

* X12-ISA
* AS2


In the following sections, we add identifiers for the supplier. We will add buyer identifers in <<Create the Buyer Identifiers>>.



==== Add Supplier X12-ISA Identifier


include::/_sources/tutorial/supplier/identifier-x12-isa-supplier.adoc[]



==== Add Supplier AS2 Identifier

include::/_sources/tutorial/supplier/identifier-as2-supplier.adoc[]

=== Upload Certificates

APM uses certificates to...

==== Upload Supplier Certificate

include::/_sources/tutorial/supplier/certificate-supplier.adoc[]

== Design a Target Channel 

The terms  _document_, _file_, and _message_ are used interchangeably in the B2B world to reflect an instance of a structured payload being passed through a system to convey information about a transaction. For consistency, we use the term document to represent these instances.

APM enables you to categorize and configure specific _Document Types_.

=== Configure the Target Document Type

. On the <<img-certificates>> in the left-hand navigation pane, in the *PARTNERS* section, click *Document Types*.
+
The xref:img-documents[] appears.

[[img-documents, Documents Page]]

image::documents.png[img-documents, title="Documents Page"]

[start=4]

. On the xref:img-documents[], click *New*.
+
The <<img-document>> appears.

[[img-document]]

image::document.png[img-document, title="Document Page"]

. On the <<img-document>>, in the *Standard* listbox, click the down-arrow, then select *JSON*.
. In the *Message Type* listbox, *PurchaseOrder*.
. Click *Save*.
+
The xref:img-documents[] appears, displaying the Document Type you added.

=== Configure Endpoints

An _endpoint_ is the entry point to a service, a process, or a queue or topic destination in service-oriented architecture.
In APM, an endpoint defines the protocol, address, and other details specific to an exchange of messages between partners.


==== Configure the Target Endpoint

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Endpoints*.
+
The <<img-endpoints>> appears.
. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *HTTP*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.+ From the list, click *Send*.
+
The <<img-endpoints>> expands to include more settings.
. Scroll down to the *Operation Settings* section.
+
In the *Host* box, type *0.0.0.0*.
. In the *Port* box, type *8086*.
. In the *Path* box, type */PurchaseOrder*.
. In the *Authentication* listbox, click the down-arrow to expand the list of available methods.
+
From the list, click *None*.
. Click *Save*.
+
The <<img-endpoints>> appears.

=== Configure Channels

==== To Configure the Target Channel

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Channels*.
+
The <<img-channels>> appears.

////
[[img-channels]]

image::channels.png[img-channels, title="Channels Page"]
////
. On the <<img-channels>>, click *New*.

The <<img-channel>> appears.
////
[[img-channel]]

image::channel.png[img-channel, title="Channel Page"]
////
. On the <<img-channel>>, in the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Target*.
. Click the *Document* box.
+
The <<img-pick-document>> appears.
. In the <<img-pick-document>>, click *JSON-PurchaseOrder-AAZFasteners*.
+
The <<img-channel>> reappears; the document you selected in <<img-pick-document>> appears in the *Document* box.

. Click the *Endpoint* box.
+
The <<img-pick-endpoint>> appears.

////
[[img-pick-endpoint]]

image::pick-endpoint.png[img-pick-endpoint, title="Pick a Endpoint Page"]
////
. In the <<img-pick-endpoint>>, click *HTTP-SEND-AAZFasteners*.
+
The <<img-channel>> reappears; the document map you selected in <<img-pick-endpoint>> appears in the *Endpoint* box.
. Click *Save*.
+
The <<img-channels>> appears.

=== Save the Transaction Draft


== Configure a Buyer

=== Create the Buyer Partner

include::/_sources/tutorial/supplier/identifier-x12-isa-supplier.adoc[]

=== Create the Buyer Identifiers

=== Upload the Buyer Certificate

=== Create the Buyer Endpoint


== Design a Source Channel

* <<Configure the Source Document Type>>
* <<Configure the Map>>
* <<Configure Buyer Endpoints>>
* <<Configure the Source Channel>>
* <<Configure Routes>>


=== Create the Source Document Type

. On the <<img-identifiers>> in the left-hand navigation pane, in the *PARTNERS* section, click *Document Types*.
+
The xref:img-documents[] appears.

[[img-documents, Documents Page]]

image::documents.png[img-documents, title="Documents Page"]

[start=4]

. On the xref:img-documents[], click *New*.
+
The <<img-document>> appears.

[[img-document]]

image::document.png[img-document, title="Document Page"]

. On the <<img-document>>, in the *Standard* listbox, click the down-arrow, then select *X12*.
. In the *Version* listbox, click the down-arrow, then select *4010*.
. In the *Message Type* listbox, click the down-arrow, then select *PO (850-Purchase Order)*
. Click *Save*
+
The xref:img-documents[] appears, displaying the Document Type you added.

=== Configure Buyer Endpoints

==== Receive

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Endpoints*.
+
The <<img-endpoints>> appears.

[[img-endpoints]]

image::endpoints.png[img-endpoints, title="Endpoints Page"]

[start=2]

. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

[[img-endpoint]]

image::endpoint.png[img-endpoint, title="Endpoint Page"]

[start=3]

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *AS2*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Receive*.

. Select *Default for AcmeHomeSupply*.
. In the URL box, enter *http://localhost:8085/edi*.
. Make sure that the *Message Encrypted* and *Message Signed* checkboxes are selected.
. Click *New Property*.
+
The <<img-add-property>> appears.

==== Add a Property

[[img-add-property]]

image::add-property.png[img-add-property, title="Add Property Window"]

[start=9]

. In the <<img-add-property>>, click *Create New Property Type*.

The <<img-create-new-property-type>> appears.

[[img-create-new-property-type]]

image::create-new-property-type.png[img-create-new-property-type, title="Create New Property Type Window"]

[start=10]

. In the *New Property Name* box, type *Direction*.
. Click *Save Property*.
+
The <<img-add-property>> appears.

. In the *Property Source Type* listbox, click the down-arrow.
+
In the drop-down list, scroll down to select *Constant*.
. In the *Path* box, type *INBOUND*.
. Click *Save Property*.
. The <<img-endpoints>> appears.

===== Send

. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *AS2*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Send*.

. Select *Default for AcmeHomeSupply*.
. In the URL box, enter *http://localhost:8089/*.
. Make sure that the following checkboxes are selected:
+
* *Message Encrypted*
* *Message Signed*
* *MDN Required*
. Click *Save*
+
The <<img-endpoints>> appears.


=== Configure the Map

A _map_ is a file that contains information necessary to transform one document type to another. In this walkthrough, we upload a map to transform a source document of the type we created in the previous section to a target document of the type we created in the previous section.

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-documents[] (or any other APM Configuration page), click *Maps*.
+
The <<img-maps>> appears.

[[img-maps]]

image::maps.png[img-maps, title="Maps Page"]

[start=2]

. On the <<img-maps>>, click *New*.
+
The <<img-map>> appears.

[[img-map]]

image::map.png[img-map, title="Map Page"]

[start=3]

. On the <<img-map>>, click *New*.
. Click the *Source Document* box.
+
The <<img-pick-document>> appears.

[[img-pick-document]]

image::pick-document.png[img-pick-document, title="Pick a Document Window"]

[start=5]

. On the <<img-pick-document>>, click the row that corresponds to the Source Document - that is, the row for which the value in the *Name* column is  *X12-00401-850-AcmeHomeSupply*.
+
The <<img-map>> appears, with *X12-00401-850-AcmeHomeSupply* in the *Source Document* box.
. Click the *Target Document* box.
+
The <<img-pick-document>> appears.

. On the <<img-pick-document>>, click the row that corresponds to the Target Document Type - that is, the row for which the value in the *Name* column is  *JSON-PurchaseOrder-AAZFasteners*.
+
The <<img-map>> appears, with *JSON-PurchaseOrder-AAZFasteners* in the *Target Document* box.
. In the *Mapping Type* box, click *DataWeave*.
+
For more information, see link:/mule-user-guide/v/3.8/dataweave[DataWeave].
. Click the *Schema File* box.
+
A file selection window specific to the operating system of the computer you are using appears.
+
In the selection window, navigate to the folder you created when you unzipped *apmf-tutorial.zip* in <<Download Tutorial Materials>>.
+
In the *Maps* folder, select *850_4010_IN.dwl*.
+
*850_4010_IN.dwl* appears in the *Schema* box.
. To view the map, click *View*.
+
The Schema Content Window appears.
+
Scroll to view the map.
+
To move on, click *Close*.
. On the <<img-map>>, click *Save*.
+
The <<img-map>> appears.




=== Configure the Source Channel

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Channels*.
+
The <<img-channels>> appears.


[[img-channels]]

image::channels.png[img-channels, title="Channels Page"]
. On the <<img-channels>>, click *New*.

The <<img-channel>> appears.

[[img-channel]]

image::channel.png[img-channel, title="Channel Page"]

. On the <<img-channel>>, in the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Source*.
. Click the *Document* box.
+
The <<img-pick-document>> appears.
. In the <<img-pick-document>>, click *X12-00401-850-AcmeHomeSupply*.
+
The <<img-channel>> reappears; the document you selected in <<img-pick-document>> appears in the *Document* box.
. Click the *Document Map* box.
+
The <<img-pick-map>> appears.

[[img-pick-map]]

image::pick-map.png[img-pick-map, title="Pick a Map Page"]

. In the <<img-pick-map>>, click *X12-00401-850-AcmeHomeSupply-JSON-PurchaseOrder-AAZFasteners*.
+
The <<img-channel>> reappears; the document map you selected in <<img-pick-map>> appears in the *Document Map* box.

. Click the *Endpoint* box.
+
The <<img-pick-endpoint>> appears.

[[img-pick-endpoint]]

image::pick-endpoint.png[img-pick-endpoint, title="Pick a Endpoint Page"]

. In the <<img-pick-endpoint>>, click *AS2-Receive-AcmeHomeSupply*.
+
The <<img-channel>> reappears; the document map you selected in <<img-pick-endpoint>> appears in the *Endpoint* box.
. Click *Save*.
+
The <<img-channels>> appears.

=== Configure Routes

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Channels*.
+
The <<img-routes>> appears.


[[img-routes]]

image::routes.png[img-routes, title="Routes Page"]
. On the <<img-routes>>, click *New*.

The <<img-route>> appears.

[[img-route]]

image::route.png[img-route, title="Route Page"]

. On the <<img-route>>, in the *Source Channel* listbox, click the down-arrow to expand the list of available channels.
+
From the list, click *Source-X12-00401-850-AcmeHomeSupply-As2*.
. In the *Target Channel* listbox, click the down-arrow to expand the list of available channels.
+
From the list, click *Target-JSON-PurchaseOrder-AAZFasteners*.
+
The <<img-routes>> appears, displaying the route you are creating.
. Click *Save*.
+
The <<img-routes>> appears.



== Configure an S3 Bucket (optional)

Configuring an Amazon Simple Storage Service (Amazon S3) bucket enables you to view message payloads in <<Monitor the Transaction>>. You will add configuration data from the bucket in <<Configure APM Routing Engine in Anypoint Studio>>.

== Copy APM Information

=== Copy your Environment ID

. On the <<anypoint-partner-manager.adoc#img-apm-start,B2B Transactions Page>>, in the left-hand navigation pane, click *Administration*, then click *Environments*.
. In the row that corresponds to the environment with which you are working, click *copy*.


=== Identify or Create an API Key

In order to create a Mule project, you must enter an link:/anypoint-b2b/glossary#secta[API Key] and an .

If you have an existing API Key, use it. If you do not know the API Key, consult your organization's MuleSoft administrator.

If your organization has not created an API Key, you can use APM to create one.

WARNING: The API Key is used by every Mule application across your entire Master link:/access-management/organization[Organization] that communicates with Anypoint Partner Manager. Therefore, before you create a new API Key, coordinate with your organization's MuleSoft administrator to ensure that none of your organization's processes are using an existing API Key because, if they are, creating a new API Key will cause them to cease functioning. In that case, instead of creating a new API Key, use the existing API Key.

To obtain a key, see link:/anypoint-b2b/administration#create-a-new-api-key[Create a New API Key].

== Download Tutorial Materials

. Download link:_attachments/apmf-tutorial.zip[apmf-tutorial.zip].
. Click *apmf-tutorial.zip* to expand it.


== Configure APM Routing Engine in Anypoint Studio

For information about using Anypoint Studio, see link:/anypoint-studio/[Anypoint Studio].

. In Anypoint Studio, click *File*. +
The File Menu appears.
. On the File Menu, click *Import*. +
The Import Source Selection Window appears.
. In the Import Source Selection Window, select *Anypoint Studio generated Deployable Archive (.zip)*.
. Click *Next*. +
The Import Mule Project Window appears.
. In the Import Mule Project Window, browse to the location to which you downloaded the archive in <<Download Tutorial Materials>>, then select the archive and click *Open*. +
The *Project Name* box auto-populates. +
NOTE: The Project Name must be unique with respect to any previously-imported projects. If it is not, *Finish* will not be enabled. If this is the case, change the Project Name so that *Finish* is enabled.

. Click *Finish*. +
The project appears in the Anypoint Studio Package Explor
. Click *Finish*. +
The project appears in the Anypoint Studio Package Expler pane.
. In the project (expand if necessary), expand the *src/main/app*, double-click *mule-app.properties*. +
Project properties appear in the Anypoint Studio Canvas.
. In Line 1, replace *insert APIKey* with the API Key you copied in <<Identify or Create an API Key>>.
. In Line 2, replace *environment ID* with the environment ID you copied in <<Copy your Environment ID>>.
. In Anypoint Studio, click *File*, then click *Save All*.


== Start the Applications

. In Package Explorer (Anypoint Studio), right-click *apm-routing-engine-nm*.
. Click *Run As*.
. Click *Mule Application (configure).
. On the *General* tab, in the *Mule domains/projects to launch* pane, select both *apm-routing-engine-nm* and *AS2-partnermock*.
. Click *Run*. +
When both applications have deployed, procede to <<Send a Message>>.


== Send a Message

. Choose and install the Postman app specific to your operating system from link:https://www.getpostman.com/apps[getpostman.com].
. In Postman, import *EDI Demo.postman_collection.json* from the location to which you downloaded in <<Download Tutorial Materials>>, then select the archive and click *Open*.
. In the imported collection, select INBOUND-850. 


== Monitor the Transaction

. In Anypoint Manager, in the left navigation pane, click *Transaction Monitoring* +
The xref:img-transaction-monitoring-tutorial[] appears. +

[[img-transaction-monitoring-tutorial]]
image::transaction-monitoring-tutorial.png[img-transaction-monitoring,title="Transaction Monitoring Page"]

The xref:img-transaction-monitoring-tutorial[] should confirm that:

* An XML purchase order was read from the company's filesystem and transformed to an X12 850 document.
* The 850 was sent to a supplier over AS2.
* The link:/anypoint-b2b/as2-connector[AS2 Connector]
 listened for (on an AS2 endpoint) and received an X12 997 document that identifies whether the 850 was accepted or rejected.

For more information, see:

* link:/anypoint-b2b/partner-configuration[Partner Configuration]
* link:/anypoint-b2b/transaction-monitoring[Transaction Monitoring]
* link:/anypoint-b2b/tracking-scenarios[Tracking Scenarios]
