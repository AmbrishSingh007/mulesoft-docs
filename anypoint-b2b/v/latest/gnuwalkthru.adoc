= APM in Action

== Before You Begin

=== Verify Your Access to Anypoint Studio and Anypoint Partner Manager

* Anypoint Studio with Mule 3.8.4
* Make sure the following connectors are installed in Studio:
** Partner Manager 6.4.1
** AS2 v2.1.0
** FTPS v2.0.0
** X12 v1.2.2
** Object Store v2.1.0
** Amazon SQS v4.1.0


=== Verify Your APM Setup

==== Environment

==== Tenant

==== Business Group

==== Username

== Download Project Materials

=== Zip

==== Routing Engine

==== Persistence Flows

==== Configuration

==== Maps

==== Sample messages

==== Certificates

==== Partner Simulator

==== Postman Collection

=== Copy your Environment ID

. On the <<anypoint-partner-manager.adoc#img-apm-start,B2B Transactions Page>>, in the left-hand navigation pane, click *Administration*, then click *Environments*.
. In the row that corresponds to the environment with which you are working, click *copy*.


=== Identify or Create an API Key

In order to create a Mule project, you must enter an link:/anypoint-b2b/glossary#secta[API Key] and an .

If you have an existing API Key, use it. If you do not know the API Key, consult your organization's MuleSoft administrator.

If your organization has not created an API Key, you can use APM to create one.

WARNING: The API Key is used by every Mule application across your entire Master link:/access-management/organization[Organization] that communicates with Anypoint Partner Manager. Therefore, before you create a new API Key, coordinate with your organization's MuleSoft administrator to ensure that none of your organization's processes are using an existing API Key because, if they are, creating a new API Key will cause them to cease functioning. In that case, instead of creating a new API Key, use the existing API Key.

To obtain a key, see link:/anypoint-b2b/administration#create-a-new-api-key[Create a New API Key].




== Install APM Routing Engine in Anypoint Studio

For information about using Anypoint Studio, see link:/anypoint-studio/[Anypoint Studio].

. In Anypoint Studio, click *File*. +
The File Menu appears.
. On the File Menu, click *Import*. +
The Import Source Selection Window appears.
. In the Import Source Selection Window, select *Anypoint Studio generated Deployable Archive (.zip)*.
. Click *Next*. +
The Import Mule Project Window appears.
. In the Import Mule Project Window, browse to the location to which you downloaded the archive (in Step 1), then select the archive and click *Open*. +
The *Project Name* box auto-populates. +
NOTE: The Project Name must be unique with respect to any previously-imported projects. If it is not, *Finish* will not be enabled. If this is the case, change the Project Name so that *Finish* is enabled.

. Click *Finish*. +
The project appears in the Anypoint Studio Package Explorer pane.
. In the project (expand if necessary), expand the *src/main/app*, double-click *mule-app.properties*. +
Project properties appear in the Anypoint Studio Canvas.
. In Line 1, *api.key = NEED_TO_FILL_IN*, replace *NEED_TO_FILL_IN* with the API Key from <<Identify or Create an API Key>>.
. In Line 2, *environment.id = NEED_TO_FILL_IN*, replace *NEED_TO_FILL_IN* with the environment ID  from <<Copy your Environment ID>>.
. In Anypoint Studio, click *File*, then click *Save All*.

== Configure Transaction Processing


=== Configure Partners

In this walkthrough, you will work with two partners: a _Supplier_ and a _Buyer_.

==== The Supplier

The Supplier, as shown in the images that follow, is *AAZFasteners*, a fictional manufacturer of screws, nuts, and bolts, also identified on the xref:img-partner-configuration[] as *YOUR COMPANY*. In your copy of APM, this partner will likely have been configured by your system administrator, and will likely have a different name, but it will still be identified as *YOUR COMPANY*.

===== View the Partner Configuration Page
. link:/anypoint-b2b/anypoint-partner-manager#start-anypoint-manager[Start APM].
The <<anypoint-partner-manager.adoc#img-apm-start,Transaction Monitoring Page>> appears.
. In the left-hand navigation pane, click *Partner Configuration*.
The xref:img-partner-configuration[] appears.
+
[[img-partner-configuration]]
image::partner-configuration.png[img-partner-configuration,title="Partner Configuration Page"]

==== The Buyer

The second partner in this walkthrough is the _Buyer_. In the next section, we create this partner, identifying it as *AcmeHomeSupply*.
In the Walkthrough, AcmeHomeSupply uses APM to order products from AAZFasteners.

===== Create the Buyer

. On xref:img-partner-configuration[], Click *Create New Partner*.
The xref:img-company-information[] appears.
+
[[img-company-information]]
image::company-information.png[img-company-information,title="Company Information Page"]

. On the xref:img-company-information[], type *AcmeHomeSupply* in the *Company Name* box.
. Click *Save*.
+
The xref:img-partner-configuration[] appears, displaying both *AAZFasteners* and *AcmeHomeSupply*.
+
NOTE: As previously mentioned, in your copy of APM, *YOUR COMPANY* is probably not named *AAZFasteners*. However, for illustration purposes, we refer to *YOUR COMPANY* as *AAZFasteners* throughout this walkthrough.

=== Identifiers

_Identifiers_ are values, communicated in messages, that can be used to uniquely identify a specific partner. Some identifiers are defined by standards bodies, such as _DUNS numbers_, which are assigned by Dun and Bradstreet. Others are mutually defined between partners. AS2 uses identifiers to identify the sender and receiver of a transmission. X12 and EDIFACT use identifiers to identify the sender and receiver of an EDI document.

For these partners, we use two identifiers:

* X12-ISA
* AS2

==== Add Supplier X12-ISA Identifier


. On the xref:img-partner-configuration[], click *AAZFasteners*.
+
The xref:img-company-information-aaz[] appears.

[[img-company-information-aaz, Company Information Page for AAZFasteners]]

image::identifiers.png[img-identifiers, title="Company Information Page for AAZFasteners"]

[start=2]

. In the *Partners* section of the left-hand navigation pane on the <<partner-configuration.adoc#img-company-information, Company Information Page>>, click *Identifiers*.
+
The <<img-identifiers>> appears.

[[img-identifiers, Identifiers Page]]

image::identifiers.png[img-identifiers, title="Identifiers Page"]

[start=3]

. On the <<img-identifiers>>, click *New*.
+
The <<img-identifier-new>> appears.

[[img-identifier-new, New Identifier Page]]

image::identifier-new.png[img-identifier-new, title="New Identifier Page"]

[start=3]

. In the *Type* box, click the down-arrow.
+
The list of types appears.
. From the list, select *X12-ISA*.
+
More identifier boxes appear.
+
(The specific boxes that appear depend on your choice in this step.)
. In the *Interchange ID Qualifier (ISA)* listbox, click the down-arrow.
+
A list of qualifiers appears.
. *AAZFasteners* and *AcmeHomeSupply* do not use standards-based identifiers, so *ZZ (Mutually Defined)* is the appropriate choice.
. In the *Interchange ID (ISA)* box, type *AAZFast*.
+

. Click *Save* to save the new identifier.
+
The <<img-identifiers-x12>> appears.


[[img-identifiers-x12, Identifiers Page (X12 Identifier Added)]]

image::identifiers-x12.png[img-identifiers-x12, title="Identifiers Page (X12-ISA Identifier Added)"]

Note that the Identifier you added in the preceding steps (*X12-ISA*) now appears.

==== Add Supplier AS2 Identifier

. On the <<img-identifiers-x12>>, click *New*.
+
The <<img-identifier-new>> appears.

. In the *Type* box, click the down-arrowhead.
+
A list of types appears.
. From the list, select *AS2*.
+
The *AS2 Identity* box appears.
. In the *AS2 Identity* box, type *AAZFast*.
. Click *Save* to save the new identifier.

The <<img-identifiers>> appears.

=== Add Buyer Identifiers

==== Change to the Buyer Partner

. On the <<img-identifiers>> (or any other APM configuration page), in the left-hand navigation pane, click *^&larr;^ Partners*.
+
The xref:img-partner-configuration[] appears.
. On the xref:img-partner-configuration[], click *AcmeHomeSupply*.
+
The xref:img-company-information[] appears.

==== Add Identifiers

After you have changed the partner you are configuring from the Supplier (AAZFasteners) to the Buyer (AcmeHomeSupply), the procedure for adding Buyer Identifiers is the same as for adding Supplier Identifiers; only the configuration details are different.

Thus, to add an X12-ISA Identifier for the Buyer, perform <<Add Supplier X12-ISA Identifier>>, substituting *ACME* for *AAZFast* for the *Interchange ID (ISA)* value in the corresponding step.

To add an AS2 Identifier, perform <<Add Supplier AS2 Identifier>>, substituting *ACME* for *AAZFast* for the *AS2 Identity* value in the corresponding step.

=== Upload Certificates

APM uses certificates to...

==== Upload the Certificate

. On the <<img-identifiers>> (or any other APM configuration page), in the left-hand navigation pane, click *^&larr;^ Partners*.
+
The xref:img-partner-configuration[] appears.
. On the xref:img-partner-configuration[], click *AAZFasteners*.
+
The xref:img-company-information[] appears.
. In the left-hand navigation pane, in the *PARTNERS* section, click *Certificate*.
+
The xref:img-certificate[] appears.

[[img-certificate, Certificate Page]]

image::certificate.png[img-certificate, title="Certificate Page"]

. Click *Choose File*.
+
A file selection window specific to the operating system of the computer you are using appears.
. In the selection window, navigate to <directory>, then select <file>.
+ <file> appears in the Certificate box.
. Click *Upload Certificate*.
+
The xref:img-certificate[] refreshes, displaying details of the uploaded certificate.

=== Configure Document Types

The terms  _document_, _file_, and _message_ are used interchangeably in the B2B world to reflect an instance of a structured payload being passed through a system to convey information about a transaction. For consistency, we use the term document to represent these instances.

APM enables you to categorize specific _Document Types_.

==== Configure the Source Document Type

. On the <<img-certificate>> (or any other APM configuration page), in the left-hand navigation pane, click *^&larr;^ Partners*.
+
The xref:img-partner-configuration[] appears.
. On the xref:img-partner-configuration[], click *ACMEHOMESUPPLY*.
+
The xref:img-company-information[] appears.
+
NOTE: If you are completing the walkthrough in sequence, these steps switch the partner you are configuring from the Supplier to the Buyer.

. In the left-hand navigation pane, in the *PARTNERS* section, click *Document Types*.
+
The xref:img-documents[] appears.

[[img-documents, Documents Page]]

image::documents.png[img-certificate, title="Documents Page"]

[start=4]

. On the xref:img-documents[], click *New*.
+
The <<img-document>> appears.

[[img-document]]

image::document.png[img-document, title="Document Page"]

. On the <<img-document>>, in the *Standard* listbox, click the down-arrow, then select *X12*.
. In the *Version* listbox, click the down-arrow, then select *4010*.
. In the *Message Type* listbox, click the down-arrow, then select *PO (850-Purchase Order)*
. Click *Save*
+
The xref:img-documents[] appears, displaying the Document Type you added.

==== Configure the Target Document Type

// 1:45

. On the <<img-documents>> (or any other APM configuration page), in the left-hand navigation pane, click *^&larr;^ Partners*.
+
The xref:img-partner-configuration[] appears.
. On the xref:img-partner-configuration[], click *AAZFasteners*.
+
The xref:img-company-information[] appears.
+
NOTE: If you are completing the walkthrough in sequence, these steps switch the partner you are configuring from the Buyer to the Supplier.

After you have changed the partner you are configuring from the  Buyer (AcmeHomeSupply) to the Supplier (AAZFasteners), the procedure for adding the Target Document Type is the same as for the Source Document Type; only the configuration details are different.

Thus, to add the Target Document, perform <<Configure the Source Document Type>>, substituting the following values in the  in the corresponding step.

Standard:: JSON
Message Type:: PurchaseOrder

After you save the Target Document Type,
the xref:img-documents[] appears, displaying the Target Document Type you added.


=== Configure Map

A _map_ is a file that contains information necessary to transform one document type to another. In this walkthrough, we upload a map to transform a source document of the type we created in the previous section to a target document of the type we created in the previous section.

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-documents[] (or any other APM Configuration page), click *Maps*.
+
The <<img-maps>> appears.

[[img-maps]]

image::maps.png[img-maps, title="Maps Page"]

[start=2]

. On the <<img-maps>>, click *New*.
+
The <<img-map>> appears.

[[img-map]]

image::map.png[img-map, title="Map Page"]

[start=3]

. On the <<img-map>>, click *New*.
. Click the *Source Document* box.
+
The <<img-map-doc-picker>> appears.

[[img-map-doc-picker]]

image::map-doc-picker.png[img-map-doc-picker, title="Document Type Selection Page"]

[start=5]

. On the <<img-map-doc-picker>>, click the row that corresponds to the Source Document - that is, the row for which the value in the *Name* column is  *X12-00401-850-AcmeHomeSupply*.
+
The <<img-map>> appears, with *X12-00401-850-AcmeHomeSupply* in the *Source Document* box.
. Click the *Target Document* box.
+
The <<img-map-doc-picker>> appears.

. On the <<img-map-doc-picker>>, click the row that corresponds to the Target Document Type - that is, the row for which the value in the *Name* column is  *JSON-PurchaseOrder-AAZFasteners*.
+
The <<img-map>> appears, with *JSON-PurchaseOrder-AAZFasteners* in the *Target Document* box.
. In the *Mapping Type* box, click *DataWeave*.
+
For more information, see link:/mule-user-guide/v/3.8/dataweave[DataWeave].
. Click the *Schema File* box.
+
A file selection window specific to the operating system of the computer you are using appears.
+
In the selection window, navigate to <directory>, then select <file>.
+
<file> appears in the *Schema* box.
. To take a look at the map, click *View*.
+
The Schema Content Window appears.
+
Scroll to view the map.
+
To move on, click *Close*.
. On the <<img-map>>, click *Save*.
+
The <<img-map>> appears.

=== Configure Endpoints

An _endpoint_ is the entry point to a service, a process, or a queue or topic destination in service-oriented architecture.
In APM, an endpoint defines the protocol, address, and other details specific to an exchange of messages between partners.

==== AcmeHomeSupply (The Buyer)

===== Receive

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Endpoints*.
+
The <<img-endpoints>> appears.

[[img-endpoints]]

image::endpoints.png[img-endpoints, title="Endpoints Page"]

[start=2]

. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

[[img-endpoint]]

image::endpoint.png[img-endpoint, title="Endpoint Page"]

[start=3]

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *AS2*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Receive*.

. Select *Default for AcmeHomeSupply*.
. In the URL box, enter *http://localhost:8085/edi*.
. Make sure that the *Message Encrypted* and *Message Signed* checkboxes are selected.
. Click *New Property*.
+
The <<img-add-property>> appears.

[[img-add-property]]

image::add-property.png[img-add-property, title="Add Property Window"]

[start=9]

. In the <<img-add-property>>, in the *Property Type* box, type *Direction*.
. In the *Property Source Type* listbox, click the down-arrow.
+
From the drop-down list, select *Constant*.
. In the *Path* box, type *INBOUND*.
. Click *Save Property*.
. The <<img-endpoints>> appears.

===== Send

. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *AS2*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.
+
From the list, click *Send*.

. Select *Default for AcmeHomeSupply*.
. In the URL box, enter *http://localhost:8089/*.
. Make sure that the following checkboxes are selected:
+
* *Message Encrypted*
* *Message Signed*
* *MDN Required*
. Click *Save*
+
The <<img-endpoints>> appears.

==== AAZFasteners (The Supplier)

. On the <<img-endpoints>> (or any other APM configuration page), in the left-hand navigation pane, click *^&larr;^ Partners*.
+
The xref:img-partner-configuration[] appears.
. On the xref:img-partner-configuration[], click *AAZFasteners*.
+
The xref:img-company-information[] appears.
+
NOTE: If you are completing the walkthrough in sequence, these steps switch the partner you are configuring from the AcmeHomeSupply (the Buyer) to AAZFasteners (the Supplier).

. In the *CONFIGURATION* section of the left-hand navigation pane on the xref:img-maps[] (or any other APM Configuration page), click *Endpoints*.
+
The <<img-endpoints>> appears.
. On the <<img-endpoints>>, click *New*.

The <<img-endpoint>> appears.

. In the *Protocol* listbox, click the down-arrow to expand the list of available protocols.
+
From the list, click *HTTP*.
. In the *Type* listbox, click the down-arrow to expand the list of available Types.
From the list, click *Send*.

. Select *Default for AcmeHomeSupply*.
. In the URL box, enter *http://localhost:8089/*.
. Make sure that the following checkboxes are selected:
+
* *Message Encrypted*
* *Message Signed*
* *MDN Required*
. Click *Save*
+
The <<img-endpoints>> appears.
. Scroll down the *Operation Settings* section.
+
In the *Host* box, type *0.0.0.0*.
. In the *Port* box, type *8086*.
. In the *Path* box, type */PurchaseOrder*.
. In the *Authentication* listbox, click the down-arrow to expand the list of available methods.
+
From the list, click *None*.
. Click *Save*.
+
The <<img-endpoints>> appears.



=== Configure Channels

==== Source Channel

@ Partners
Buyer
Channels
@ Channels
! New
@ Channel
! Source
! Document
@ Pick a document Modal
Pick X12-00401-850-Buyer
@ Channel
Document Map
@ Pick a Map Modal
! X12-00401-850-Buyer-JSON-PurchaseOrder-Supplier
! Endpoint
@ Pick a endpoint

==== Target Channel

@ Supplier

! Channels

@ Channels

! New

@ Channel
!


Autofills to Target-JSON-PurchaseOrder-Supplier-Http






=== Configure Routes

@ Trading Partners

! Buyer

@ Buyer

! Routes

@ Routes

! New

@ Route

! Source Channel

@ SC Picker

! Pick

! Target Channel

@ TC Picker

! Pick



== Configure Partner Simulator

== Install Request Generator

. Choose and install the Postman app specific to your operating system from link:https://www.getpostman.com/apps[getpostman.com].
. Import the xxx collection from yyy.


== Start Walkthru

== Monitor Transactions
