= APM in Action

== Before You Begin

=== Verify Your Access to Anypoint Studio and Anypoint Partner Manager

* Anypoint Studio with Mule 3.8.4
* Make sure the following connectors are installed in Studio:
** Partner Manager 6.4.1
** AS2 v2.1.0
** FTPS v2.0.0
** X12 v1.2.2
** Object Store v2.1.0
** Amazon SQS v4.1.0


=== Verify Your APM Setup

==== Environment

==== Tenant

==== Business Group

==== Username

== Download Project Materials

=== Zip

==== Routing Engine

==== Persistence Flows

==== Configuration

==== Maps

==== Sample messages

==== Certificates

==== Partner Simulator

==== Postman Collection

=== Copy your Environment ID

. On the <<anypoint-partner-manager.adoc#img-apm-start,B2B Transactions Page>>, in the left-hand navigation pane, click *Administration*, then click *Environments*.
. In the row that corresponds to the environment with which you are working, click *copy*.


=== Identify or Create an API Key

In order to create a Mule project, you must enter an link:/anypoint-b2b/glossary#secta[API Key] and an .

If you have an existing API Key, use it. If you do not know the API Key, consult your organization's MuleSoft administrator.

If your organization has not created an API Key, you can use APM to create one.

WARNING: The API Key is used by every Mule application across your entire Master link:/access-management/organization[Organization] that communicates with Anypoint Partner Manager. Therefore, before you create a new API Key, coordinate with your organization's MuleSoft administrator to ensure that none of your organization's processes are using an existing API Key because, if they are, creating a new API Key will cause them to cease functioning. In that case, instead of creating a new API Key, use the existing API Key.

To obtain a key, see link:/anypoint-b2b/administration#create-a-new-api-key[Create a New API Key].




== Install APM Routing Engine in Anypoint Studio

For information about using Anypoint Studio, see link:/anypoint-studio/[Anypoint Studio].

. In Anypoint Studio, click *File*. +
The File Menu appears.
. On the File Menu, click *Import*. +
The Import Source Selection Window appears.
. In the Import Source Selection Window, select *Anypoint Studio generated Deployable Archive (.zip)*.
. Click *Next*. +
The Import Mule Project Window appears.
. In the Import Mule Project Window, browse to the location to which you downloaded the archive (in Step 1), then select the archive and click *Open*. +
The *Project Name* box auto-populates. +
NOTE: The Project Name must be unique with respect to any previously-imported projects. If it is not, *Finish* will not be enabled. If this is the case, change the Project Name so that *Finish* is enabled.

. Click *Finish*. +
The project appears in the Anypoint Studio Package Explorer pane.
. In the project (expand if necessary), expand the *src/main/app*, double-click *mule-app.properties*. +
Project properties appear in the Anypoint Studio Canvas.
. In Line 1, *api.key = NEED_TO_FILL_IN*, replace *NEED_TO_FILL_IN* with the API Key from <<Identify or Create an API Key>>.
. In Line 2, *environment.id = NEED_TO_FILL_IN*, replace *NEED_TO_FILL_IN* with the environment ID  from <<Copy your Environment ID>>.
. In Anypoint Studio, click *File*, then click *Save All*.

== Configure Transaction Processing


=== Configure Partners

In this walkthrough, you will work with two partners: a supplier and a buyer.

==== The Supplier

The Supplier, as shown in the images in the walkthrough, is *AAZFasteners*, a fictional manufacturer of screws, nuts, and bolts, also identified on the xref:img-partner-configuration[] as *YOUR COMPANY*. In your copy of APM, this partner will likely have been configured by your system administrator, and will likely have a different name, but it will still be identified as *YOUR COMPANY*.

===== View the Partner Configuration Page
. link:/anypoint-b2b/anypoint-partner-manager#start-anypoint-manager[Start APM].
The <<anypoint-partner-manager.adoc#img-apm-start,Transaction Monitoring Page>> appears.
. In the left-hand navigation pane, click *Partner Configuration*.
The xref:img-partner-configuration[] appears.
+
[[img-partner-configuration]]
image::partner-configuration.png[img-partner-configuration,title="Partner Configuration Page"]
+
Note that, in xref:img-partner-configuration[], a single partner, *AAZFasteners*, appeaars, and is labeled *YOUR COMPANY*.
In APM, this partner is typically configured by your system administrator, and is also known as the _Home Partner_.

==== The Buyer

The second partner in this walkthrough is the _Buyer_. In the next section, we create this partner, identifying it as *AcmeHomeSupply*.
In the Walkthrough, AcmeHomeSupply will use APM to order products from AAZFasteners.

===== Create the Buyer

. On xref:img-partner-configuration[], Click *Create New Partner*. The xref:img-company-information[] appears.
+
[[img-company-information]]
image::company-information.png[img-company-information,title="Company Information Page"]

. On the xref:img-company-information[] enter *AcmeHomeSupply* in the *Company Name* box.
. Click *Save*.

=== Identifiers

=== Certificates

=== Configure Document Types

==== Source Doc

Partner Configuration/Buyer/Document Types/New
Standard: X12
Version: 4010
Message Type: 850

Partner Configuration/Buyer/Document Types/Documents
X12-00401-850-Buyer

==== Target Doc


Partner Configuration/Supplier/Document Types/New

Standard: JSON
Message Type: PurchaseOrder

Partner Configuration/Supplier/Document Types
JSON-PurchaseOrder-Supplier

=== Configure Map

Partner Configuration/Buyer/Maps/New/

Source Document - pick X12-00401-850-Buyer
Target Document - pick JSON-PurchaseOrder-Supplier
Mapping Type: DataWeave
Map Definition: Choose from saved

==== View Map

Partner Configuration/Buyer/Maps
Select added map, review

=== Configure Endpoints

==== Buyer

===== Receive

Partner Configuration/Endpoints/New

Protocol: AS2
Type: Receive
URL: http://localhost:8085/edi
Select Message Encrypted, Message signed

====== Create Property

New Property
@ Add Property Modal
Direction
* may need to add prop
Constant
Inbound
Save
@ Endpoint Page shows new PropType
Save

@ Endpoints shows new Endpoint

===== Send

@ Endpoints Page
New
@ Endpoint Page
AS2
Send
URL: http://localhost:8089/850
Encrypted, Signed, MDN Required
Save
@ Endpoints Page shows both new endpoints

==== Supplier (HomeOrg)

@ Supplier/Endpoints
New
@ Endpoint Page
Send, HTTP
Operation Settings/Host = 0.0.0.0
Port:8086
Path: /PurchaseOrder
Authentication: None
Save
@ Endpoints Page shows new endpoint (HTTP-Send-Supplier)


=== Configure Channels

==== Source Channel

@ Partners
Buyer
Channels
@ Channels
! New
@ Channel
! Source
! Document
@ Pick a document Modal
Pick X12-00401-850-Buyer
@ Channel
Document Map
@ Pick a Map Modal
! X12-00401-850-Buyer-JSON-PurchaseOrder-Supplier
! Endpoint
@ Pick a endpoint

==== Target Channel

@ Supplier

! Channels

@ Channels

! New

@ Channel
!


Autofills to Target-JSON-PurchaseOrder-Supplier-Http






=== Configure Routes

@ Trading Partners

! Buyer

@ Buyer

! Routes

@ Routes

! New

@ Route

! Source Channel

@ SC Picker

! Pick

! Target Channel

@ TC Picker

! Pick



== Configure Partner Simulator

== Install Request Generator

. Choose and install the Postman app specific to your operating system from link:https://www.getpostman.com/apps[getpostman.com].
. Import the xxx collection from yyy.


== Start Walkthru

== Monitor Transactions
