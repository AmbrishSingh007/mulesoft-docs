= SAP Concur Connector
:keywords: concur connector, user guide, user manual
:imagesdir: ./_images

_Select_

SAP Concur is a SaaS provider from SAP for integrated travel and expense management solutions.

Anypoint Connector for Concur operates as a bi-directional gateway between instances of Concur and Mule. It is a closed-source connector that supports SOAP and REST calls to various Concur APIs.

== Prerequisites

This document assumes that you are familiar with Mule, Anypoint Connectors, Anypoint Studio, Mule concepts, elements in a Mule flow, and Global Elements.

You need login credentials to test your connection to your target resource.

For hardware and software requirements and compatibility
information, see the Connector Release Notes.

To use this connector with Maven, view the pom.xml dependency information in
the Dependency Snippets in Anypoint Exchange.

== To Connect in Design Center

. In Design Center, click Set Up > Upload, browse for and select the driver for this connector on your file system, and upload it. Alternatively, search for and select a driver that is already uploaded.
. Click a trigger. You can create a global element by selecting this connector as their trigger.
If a global element is not needed, you can use an HTTP Listener or Scheduler trigger.
+
image:sap-concur-trigger.png[Trigger options]
+
. To create an HTTP global element for the connector, set these fields:
+
image:sap-concur-http-listener.png[Http Listener configuration]
+
[%header%autowidth.spread]
|===
|Field |Description
|Protocol | Protocol selected for the HTTP endpoint, it can be HTTP or HTTPS (secure).
|Host| IP address where your Mule application listens for requests.
|Port| Port address where your Mule application listens for requests.
|Base| Path where your Mule application listens for requests.
|===
+
. Select the plus sign to add a component.
+
image:sap-concur-plus-sign.png[add connector]
+
. Select the connector as a component.
. Select an operation (see the next section for a list of operations).
. Configure the Global element for the connector.
+
image:sap-concur-config-design.png[config connector]
+
[%header%autowidth]
|===
|Field |Description
|Host | Enter the host name of the Concur connector.
|Port | Enter the port on which the Concur connector is running. Default value is 443.
|Base Path | Path where your Mule application listens for requests.
|Protocol |Protocol selected for the http endpoint, it can be http or https (secure).
|Authorization| A Concur access token.
|===

== About the Operations

image:sap-concur-operations-design.png[operations Connector]
+
[%header%autowidth.spread]
|===
|Operation | Description
|Approve a trip | Approve a trip
|Close a payment batch | This request closes the specified batch, preventing any new expenses from entering it.
|Create a Report Exception | Posts an exception to the report, and associates it with one of the following data levels: Report Header, Entry, Itemization, Allocation. This endpoint 
requires familiarity with the companyâ€™s exception code configuration.
|Create an Attendee | Create a new attendee.
|Create an Attendee Type | Creates a new attendee type.
|Create an Entry Attendee Association | Creates a new entry-attendee association.
|Create an Expense Entry | Create a new expense entry.
|Create an Expense Itemization | Creates a new expense itemization.
|Create an Expense Receipt Image | Create a new receipt image.
|Create an Expense Report | Create a new report.
|Create Expense Reports | Posts a batch of expense report headers. The expense report header contains classification information for the expense report.
|Create or update users with batch of user profiles | Create or update users with batch of user profiles.
|Create quick expense | Create a quick expense.
|Delete Attendee Type | Deletes the specified attendee type.
|Delete Entry Attendee Association | Deletes the specified entry-attendee association.
|Get a QuickExpense | Get a QuickExpense by its ID.
|Get a Receipt Image | Get a Receipt Image.
|Get a single expense entry | Get a single expense entry
|Get a travel profile | Provides travel profile information for the specified user.
|Get all requests | Get list of travel requests.
|Get Allocations | Get all allocations.
|Get an Allocation | Get an allocation.
|Get an attendee | Get an attendee.
|Get Attendee Type | Gets an attendee type by ID.
|Get Attendee Types | Gets all active attendee types for the company.
|Get attendees | Get all attendees.
|Get Card Charges | This request returns a CardCharges parent element with a CardCharge child element for each transaction.
|Get Entry Attendee Association | Gets an entry-attendee association by ID.
|Get Entry Attendee Associations | Gets all entry-attendee associations owned by the user. These are the associations between an expense entry and an attendee.
|Get Expense delegators | Retrieves the list of users that have granted delegate permissions to the user specified in the OAuth access token.
|Get expense entries | Get all expense entries.
|Get Expense Group Configuration | Gets the configuration of an expense group.
|Get Expense Itemization | Retrieve an expense itemization by ID.
|Get Expense Itemizations | Gets all expense itemizations owned by the user.
|Get Expense Report | Get an Expense Report
|Get Form Data | Retrieves the list of configured forms for the specified form type.
|Get Form Fields | Retrieves the details of the configured form fields for the specified form.
|Get Form Types | Retrieves the list of users that have granted delegate permissions to the user specified in the OAuth access token.
|Get Global Form Fields | Retrieves a list of configured fields on the Global employee form in Concur.
|Get Itinerary Details | Get itinerary details.
|Get List Details | Retrieves the list details for a specified list. Includes configuration information, not the list items.
|GET List Items | Retrieves the list items for the specified list.
|Get List of Itineraries | Retrieve the List of itineraries.
|Get List of Lists | Returns a lists parent element containing a list child element for each configured list.
|Get Payment Batches |  Retrieves the list of payment batches with an optional requested status.
|Get quick expenses | Retrieve all quick expenses.
|Get reports | Gets all reports
|Get Tax Invoices | Retrieves all digital tax invoices that can be validated by the user based on the search criteria.
|Get the list of forms of payment | Provides the list of forms of payment.
|Get the list of updated travel profiles | Provides a list of travel profile summaries that have been updated since the specified date.
|Get User Profile | Retrieve the user profile.
|Make Batch updates to List Items | Adds list items to an existing list.
|Make updates to the loyalty programs | Updates the loyalty program information for the OAuth consumer.
|Put Expense Report | Updates report specified in the URL. Only the fields provided in the supplied object are updated, missing fields are not altered.
|Update an expense entry | Updates the specified expense entry. Only the fields provided in the supplied object are updated. Missing fields are not altered.
|Update Attendee Type | Updates the specified attendee type. Only the fields provided in the supplied object are updated. Missing fields are not altered.
|Update Entry Attendee Association | Updates the specified entry-attendee association. Only the fields provided in the supplied object are updated. Missing fields are not altered.
|Update Expense Itemization | Updates the specified expense itemization. Only the fields provided in the supplied object are updated. Missing fields are not altered.
|Update Users Password | This resource allows you to update passwords for up to 500 users.
|Updates a quick expense | Updates a quick expense.
|===

== About Concur API Availability

Review the SAP Concur Connector Reference for the supported API.

== Connect in Anypoint Studio 7

You can use this connector in Anypoint Studio by adding it as a dependency in your Mule application.

=== Install Connector in Studio

. Open your Mule project in Anypoint Studio.
. Add the connector as a dependency in the pom.xml file:
+
[source, linenums]
----
<dependency>
  <groupId>org.mule.modules</groupId>
  <artifactId>mule-module-concur</artifactId>
  <version>4.0.3</version>
  <classifier>mule-plugin</classifier>
</dependency>
----

== Example Use Case

This guide presents two of many use cases you might have for the Concur connector in your organization: getting a list of lists and retrieving quickexpenses. You may jump ahead and paste the code for the flows into the XML Editor in Studio after you download the Concur connector and create a global element to reference your Concur instance credentials.

=== Retrieve a List of Lists

After creating a new project and a Concur global element:

. Add a new flow element by dragging it from the palette and give a name to the flow, such as `getlists`.
. Drag an HTTP Listener into your flow from the palette.
. Double-click the HTTP Listener and click the green plus sign next to the Connector Configuration dropdown and set the Host to localhost, and the Port to 8081.
. Click OK to close the properties window, then enter getlists as the value in the Path field in this HTTP listener's Basic Settings section.
. Add a Concur connector to the new flow and select the Get list of lists operation, after selecting the Connector Configuration you desire.
. Finally, add a Transform Message transformer to the flow.
. For reference you may check the particular getlists flow within the example XML code further down.

To execute the flow and check the outcome:

. Right-click the project in the Package Explorer, and click Run As > Mule Application.
. Check that the application has started by monitoring the Studio console.
. Open browser and go to `+http://localhost:8081/getlist+`
. You should receive a JSON response like this:
+
[source,json,linenums]
----
{"list":[{"batchLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRt9CeqUjOAfZXRTmGyyVczqg/batch","id":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRt9CeqUjOAfZXRTmGyyVczqg","isVendor":false,"itemsLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRt9CeqUjOAfZXRTmGyyVczqg/items","levels":1,"name":"AT Tax Form List 1"},
{"batchLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRsUIXmIbg3iUc6qE9AlKEVxA/batch","id":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRsUIXmIbg3iUc6qE9AlKEVxA","isVendor":false,"itemsLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GsRsUIXmIbg3iUc6qE9AlKEVxA/items","levels":1,"name":"BE Tax Form List 1"},
{"batchLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GscWDPncbQqGUoCjCv4pxrnp2A/batch","id":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GscWDPncbQqGUoCjCv4pxrnp2A","isVendor":false,"itemsLink":"https://www.concursolutions.com/api/expense/list/v1.0/gWqXO46r6GscWDPncbQqGUoCjCv4pxrnp2A/items","levels":1,"name":"CH Tax Form List 1"}
----
+
. Click the stop button to halt the server running the application.

=== Create a Quick Expense

. Add a new flow element by dragging it from the palette and name it getquickexpenses.
. Add an HTTP Listener to your flow by dragging it from the palette.
. Use the configuration from the first demo, or if you did not create that flow, click the green plus sign next to Connector Configuration for the HTTP endpoint and enter localhost as the Host and 8081 for the Port.
+
. Click OK to close the properties window, then enter getquickexpenses as the value in the Path field in this HTTP listener's Basic Settings section.

. Add the Concur connector to the new flow, referencing a global element from the Connector Configuration and set an Operation to perform and any other properties you require.
. Finally, add an Transform Message transformer link in the previous example.

To execute the flow and check the outcome, perform the following steps:

. Right-click on the project in the Package Explorer > Run As > Mule Application
. Check the console to see when the application starts.
. Open the browser and go to `+http://localhost:8081/getquickexpenses+`
. You should receive a JSON response like this:
+
[source,json,linenums]
----
{"items":{"quickExpense":[{"comment":"","currencyCode":"USD","expenseTypeCode":"UNDEF","expenseTypeName":"Undefined","id":"gWr7TiTHdIi5fyWCPBRPtqjeCIWyv2w","locationName":"","ownerLoginID":"","ownerName":"Unknown","paymentTypeCode":"PENDC","receiptImageID":"","transactionAmount":111.0,"transactionDate":"2018-07-21T00:00:00","uri":"https://www.concursolutions.com/api/v3.0/expense/quickexpenses/gWr7TiTHdIi5fyWCPBRPtqjeCIWyv2w","vendorDescription":""},
{"comment":"","currencyCode":"USD","expenseTypeCode":"UNDEF","expenseTypeName":"Undefined","id":"gWr7TiTXbQ47PtJ$pVkr6CzbLeRVRPww","locationName":"","ownerLoginID":"","ownerName":"Unknown","paymentTypeCode":"PENDC","receiptImageID":"","transactionAmount":111.0,"transactionDate":"2018-07-21T00:00:00","uri":"https://www.concursolutions.com/api/v3.0/expense/quickexpenses/gWr7TiTXbQ47PtJ$pVkr6CzbLeRVRPww","vendorDescription":""},
----
+
. Click the stop button to halt the server running the application.

== See Also

* https://www.concur.com[Concur].
* https://developer.concur.com/api-reference/expense/expense-report/reports.html[Expense Report Resource page].
* https://developer.concur.com/api-reference-deprecated/version-one-one/expense-entry/get-expense-entry.html[Get Expense Entry Details].
